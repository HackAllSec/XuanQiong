import{d as k,u as I,o as x,a as S,r as m,c as y,f as n,w as u,g as t,ab as g,h as V,b as E,Z as T,ac as z,ad as B,e as C,n as f,t as w,v as s,ae as L,x as N,af as D,y as M,_ as K}from"./index-PUrVetuF.js";import{a as U}from"./el-message-ZkJEpQUo.js";/* empty css                */const j={class:"login-container"},A={class:"login-option"},P=k({__name:"Login",setup(R){const{t:a,locale:Z}=I();function v(){let e=sessionStorage.getItem("token");if(e){try{const o=g(e);if(o.role!=1){sessionStorage.removeItem("token"),sessionStorage.removeItem("username"),sessionStorage.removeItem("avatar");return}if(Math.floor(Date.now()/1e3)>o.exp){sessionStorage.removeItem("token"),sessionStorage.removeItem("username"),sessionStorage.removeItem("avatar");return}}catch{sessionStorage.removeItem("token"),sessionStorage.removeItem("username"),sessionStorage.removeItem("avatar"),location.reload();return}d.push("/")}}x(v);const d=S(),i=m(""),l=m("");async function c(){if(i.value==""||l.value==""){s.error("账号或密码不能为空");return}try{const e=await U.post("/api/v1/login",{username:i.value,password:l.value});if(console.log(e.data),e.data.token){if(g(e.data.token).role!=1){s.error(a("app.webui.nopermation"));return}L({title:a("app.webui.loginsucc"),message:e.data.username+", "+a("app.webui.welcome"),type:"success"}),await new Promise(r=>setTimeout(r,1e3)),sessionStorage.setItem("token",e.data.token),sessionStorage.setItem("username",e.data.username),e.data.avatar==""?sessionStorage.setItem("avatar","/avatar.svg"):sessionStorage.setItem("avatar","/download/file?id="+e.data.avatar),d.push("/")}else e.data.code==0?s.error(a("app.webui.loginerr3")):e.data.code==2?s.error(a("app.webui.inputformaterror")):e.data.code==3&&s.error(a("app.webui.loginerr4")+" "+e.data.times+" "+a("app.webui.times"))}catch(e){console.error(e),s.error("登录请求失败")}}return(e,o)=>{const r=N,_=D,h=M,b=V;return E(),y("div",j,[n(b,{class:"login-card",header:t(a)("app.webui.login"),shadow:"always"},{default:u(()=>[n(r,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=p=>i.value=p),maxlength:"50",placeholder:t(a)("app.webui.username"),size:"large","prefix-icon":t(T),clearable:""},null,8,["modelValue","placeholder","prefix-icon"]),n(r,{modelValue:l.value,"onUpdate:modelValue":o[1]||(o[1]=p=>l.value=p),maxlength:"50",type:"password","show-password":"",placeholder:t(a)("app.webui.password"),size:"large","prefix-icon":t(z),clearable:"",onKeyup:B(c,["enter","native"])},null,8,["modelValue","placeholder","prefix-icon"]),C("div",A,[n(_,{href:"#/forgotpwd",style:{"margin-right":"10px"}},{default:u(()=>[f(w(t(a)("app.webui.forgot")),1)]),_:1})]),n(h,{type:"success",size:"large",style:{width:"60%",margin:"2% 20%","margin-bottom":"20px","font-weight":"bold","font-size":"16px"},onClick:c,"auto-insert-space":""},{default:u(()=>[f(w(t(a)("app.webui.login")),1)]),_:1})]),_:1},8,["header"])])}}}),H=K(P,[["__scopeId","data-v-4e4e400b"]]);export{H as default};
